-- âœ… Function: Wait for Previous Worker Turtle to be Removed
local function waitForTurtleRemoval()
    print("â³ Waiting for previous Worker Turtle to be removed...")
    while turtle.detect() do
        sleep(2)
    end
    print("âœ… Worker Turtle removed! Placing next one.")
end

-- âœ… Function: Place and Setup New Worker Turtle
local function deployWorker(turtleIndex)
    print("ðŸ“¦ Placing Worker Turtle for `output_" .. turtleIndex .. ".lua`")

    -- Wait for space before placing
    waitForTurtleRemoval()

    -- âœ… Place the Worker Turtle
    if not turtle.place() then
        print("âŒ ERROR: Failed to place Worker Turtle!")
        return
    end

    -- Sleep to allow Turtle to initialize
    sleep(2)

    -- âœ… Wrap the Turtle as a Peripheral
    local worker = peripheral.wrap("front")
    if not worker then
        print("âŒ ERROR: No Worker Turtle detected after placement!")
        return
    end

    -- âœ… Write the index to a file on the Worker Turtle
    local indexString = tostring(turtleIndex)
    print("ðŸ“¡ Assigning Block Data Index:", indexString)
    worker.run("rm /block_index.txt") -- Remove any previous index
    worker.run("echo " .. indexString .. " > /block_index.txt")

    -- âœ… Copy necessary files from Disk Drive
    print("ðŸ“‚ Copying files from Disk Drive to Worker Turtle...")
    worker.run("cp /disk/startup.lua /startup")
    worker.run("cp /disk/build.lua /build.lua")

    -- âœ… Tell the Worker Turtle to reboot
    print("ðŸ”„ Rebooting Worker Turtle to start...")
    worker.run("reboot")

    print("âœ… Worker Turtle setup complete!")
end

-- âœ… Main Loop: Deploy Worker Turtles Sequentially
local totalFiles = 122
local startIndex = 1

for i = startIndex, totalFiles do
    deployWorker(i)
    print("âœ… Worker Turtle #" .. i .. " is running! Waiting for removal before placing the next one...")
end

print("ðŸŽ‰ All Worker Turtles deployed!")
