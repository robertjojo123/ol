-- âœ… Placer Turtle Settings
local totalFiles = 122
local startIndex = 1

-- âœ… Function: Wait for Previous Worker Turtle to be Removed
local function waitForTurtleRemoval()
    print("â³ Waiting for previous Worker Turtle to be removed...")
    while turtle.detect() do
        sleep(2)
    end
    print("âœ… Worker Turtle removed! Placing next one.")
end

-- âœ… Function: Write `block_data_index.txt` to Worker Turtle
local function writeToWorker(filePath, content)
    local file = fs.open("front/" .. filePath, "w")
    if file then
        file.write(content)
        file.close()
        sleep(0.5) -- Ensure the file system registers the file
        return true
    else
        print("âŒ ERROR: Failed to write `" .. filePath .. "` to Worker Turtle!")
        return false
    end
end

-- âœ… Function: Place and Setup New Worker Turtle
local function deployWorker(turtleIndex)
    print("ğŸ“¦ Placing Worker Turtle for `output_" .. turtleIndex .. ".lua`")

    -- Wait for space before placing
    waitForTurtleRemoval()

    -- âœ… Place the Worker Turtle
    if not turtle.place() then
        print("âŒ ERROR: Failed to place Worker Turtle!")
        return
    end

    -- Sleep to allow Turtle to initialize
    sleep(2)

    -- âœ… Write `block_data_index.txt` inside Worker Turtle
    print("ğŸ“‚ Assigning Block Data Index:", turtleIndex)
    if not writeToWorker("block_data_index.txt", tostring(turtleIndex)) then
        print("âŒ ERROR: Failed to assign Block Data Index!")
        return
    end

    -- âœ… Turn On Worker Turtle (Runs `startup.lua` from Disk Drive)
    print("ğŸ”„ Turning on Worker Turtle...")
    peripheral.call("front", "turnOn")

    print("âœ… Worker Turtle setup complete!")
end

-- âœ… Main Loop: Deploy Worker Turtles Sequentially
for i = startIndex, totalFiles do
    deployWorker(i)
    print("âœ… Worker Turtle #" .. i .. " is running! Waiting for removal before placing the next one...")
end

print("ğŸ‰ All Worker Turtles deployed!")
