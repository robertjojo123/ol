-- âœ… Function: Wait for Previous Worker Turtle to be Removed
local function waitForTurtleRemoval()
    print("â³ Waiting for previous Worker Turtle to be removed...")
    while turtle.detect() do
        sleep(2)
    end
    print("âœ… Worker Turtle removed! Placing next one.")
end

-- âœ… Function: Assign Block Index to Disk Drive
local function assignBlockIndex(index)
    -- Check if a Disk Drive is present
    local diskDrive = peripheral.find("drive")
    if not diskDrive then
        print("âŒ ERROR: No Disk Drive detected! Place a Disk Drive near the Worker Turtle.")
        return false
    end

    -- Write the index to a file on the Disk
    print("ğŸ“ Assigning Block Data Index:", index)
    local file = fs.open("/disk/block_index.txt", "w")
    file.write(index)
    file.close()

    return true
end

-- âœ… Function: Place and Setup New Worker Turtle
local function deployWorker(turtleIndex)
    print("ğŸ“¦ Placing Worker Turtle for `output_" .. turtleIndex .. ".lua`")

    -- Wait for space before placing
    waitForTurtleRemoval()

    -- âœ… Place the Worker Turtle
    if not turtle.place() then
        print("âŒ ERROR: Failed to place Worker Turtle!")
        return
    end

    -- Sleep to allow Turtle to initialize
    sleep(2)

    -- âœ… Assign the block index to the Disk Drive
    if not assignBlockIndex(turtleIndex) then
        print("âŒ ERROR: Block index assignment failed. Shutting down Worker Turtle.")
        return
    end

    -- âœ… Turn On Worker Turtle (it will run the startup program from the Disk)
    print("ğŸ”„ Turning on Worker Turtle...")
    peripheral.call("front", "turnOn")

    print("âœ… Worker Turtle setup complete! Waiting for next one to be removed...")
end

-- âœ… Main Loop: Deploy Worker Turtles Sequentially
local totalFiles = 122

for i = 1, totalFiles do
    deployWorker(i)
end

print("ğŸ‰ All Worker Turtles deployed!")
