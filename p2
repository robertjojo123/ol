-- âœ… Placer Turtle Settings
local blockDataBaseUrl = "https://raw.githubusercontent.com/robertjojo123/olympus2/refs/heads/main/output_"
local totalFiles = 122
local startIndex = 1
local diskSide = "left" -- Adjust if Disk Drive is on another side

-- âœ… Check for Disk Drive
if not peripheral.isPresent(diskSide) or peripheral.getType(diskSide) ~= "drive" then
    print("âŒ ERROR: No Disk Drive detected on " .. diskSide)
    return
end

-- âœ… Function: Wait for Previous Turtle to be Removed
local function waitForTurtleRemoval()
    while turtle.detect() do
        print("â³ Waiting for previous Turtle to be removed...")
        sleep(2)
    end
end

-- âœ… Function: Place and Setup New Worker Turtle
local function deployWorker(turtleIndex)
    print("ğŸ“¦ Placing new Worker Turtle for output_" .. turtleIndex .. ".lua")
    
    -- Wait until there's space
    waitForTurtleRemoval()
    
    -- Place the new Worker Turtle
    turtle.place()
    
    -- Wrap the Worker Turtle as a peripheral
    local worker = peripheral.wrap("front")
    if not worker then
        print("âŒ ERROR: Could not detect placed Worker Turtle!")
        return
    end
    
    -- Tell the Worker Turtle to copy `startup.lua` from the Disk Drive
    print("ğŸ“‚ Copying startup.lua from Disk Drive...")
    worker.run("cp /disk/startup.lua /startup")
    
    -- Tell the Worker Turtle to download its unique `output_X.lua`
    local outputUrl = blockDataBaseUrl .. turtleIndex .. ".lua"
    print("ğŸ“¥ Instructing Worker Turtle to download block data:", outputUrl)
    worker.run("wget", outputUrl, "output.lua")
    
    -- Power on the Worker Turtle
    print("ğŸ”Œ Turning on Worker Turtle!")
    worker.turnOn()
end

-- âœ… Main Loop: Deploy Worker Turtles Sequentially
for i = startIndex, totalFiles do
    deployWorker(i)
    print("âœ… Worker Turtle #" .. i .. " is now running! Waiting for removal before next one...")
    waitForTurtleRemoval() -- Wait before placing the next Turtle
end

print("ğŸ‰ All Worker Turtles deployed!")
